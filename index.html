<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aprendizagem Avançada de Lógica de Programação</title>
    <style>
        /* ... (estilos anteriores mantidos) ... */
        .obstáculo { background-color: #ff9900; }
        .chave { background-color: #ffff00; }
        .porta { background-color: #8b4513; }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- ... (estrutura HTML anterior mantida) ... -->
        <div class="code-editor">
            <h2>Seu Código!</h2>
            <textarea id="codigo" placeholder="Digite seu código aqui..."></textarea>
            <button onclick="executarCodigo()" class="botao">Run</button>
            <button onclick="proximoNivel()">Next Level</button>
            <button onclick="reiniciarNivel()">Restart Level</button>
        </div>
    </div>

    <script>
        // ... (variáveis e funções anteriores mantidas) ...

        const niveis = [
            // ... (níveis anteriores mantidos) ...
            {
                tamanho: 7,
                instrucoes: "Use condicionais para evitar obstáculos. Exemplo: if(temObstáculoADireita()) { moverBaixo(); } else { moverDireita(); }",
                solucaoEsperada: [
                    "function moverSeguro() {",
                    "  if(temObstáculoADireita()) {",
                    "    moverBaixo();",
                    "  } else {",
                    "    moverDireita();",
                    "  }",
                    "}",
                    "for(let i=0; i<6; i++) {",
                    "  moverSeguro();",
                    "}"
                ],
                obstáculos: [[2,3], [3,5], [4,1], [5,4]]
            },
            {
                tamanho: 8,
                instrucoes: "Colete a chave antes de abrir a porta. Use 'pegarChave()' para coletar a chave.",
                solucaoEsperada: [
                    "moverDireita();",
                    "moverDireita();",
                    "moverBaixo();",
                    "moverBaixo();",
                    "pegarChave();",
                    "moverDireita();",
                    "moverDireita();",
                    "moverBaixo();",
                    "moverBaixo();",
                    "abrirPorta();",
                    "moverDireita();",
                    "moverDireita();"
                ],
                chave: [2,2],
                porta: [4,6]
            }
        ];

        let temChave = false;

        function criarLabirinto(tamanho) {
            // ... (código anterior mantido) ...
            if (niveis[nivelAtual].obstáculos) {
                for (let obs of niveis[nivelAtual].obstáculos) {
                    labirinto[obs[0]][obs[1]] = 'obstáculo';
                }
            }
            if (niveis[nivelAtual].chave) {
                labirinto[niveis[nivelAtual].chave[0]][niveis[nivelAtual].chave[1]] = 'chave';
            }
            if (niveis[nivelAtual].porta) {
                labirinto[niveis[nivelAtual].porta[0]][niveis[nivelAtual].porta[1]] = 'porta';
            }
        }

        function mostrarLabirinto() {
            // ... (código anterior mantido) ...
        }

        function moverDireita() {
            if (posicaoJogador[1] < labirinto[0].length - 1 && labirinto[posicaoJogador[0]][posicaoJogador[1]+1] !== 'obstáculo') {
                if (labirinto[posicaoJogador[0]][posicaoJogador[1]+1] === 'porta' && !temChave) {
                    throw new Error("Você precisa da chave para abrir a porta!");
                }
                posicaoJogador[1]++;
                mostrarLabirinto();
            }
        }

        function moverBaixo() {
            if (posicaoJogador[0] < labirinto.length - 1 && labirinto[posicaoJogador[0]+1][posicaoJogador[1]] !== 'obstáculo') {
                if (labirinto[posicaoJogador[0]+1][posicaoJogador[1]] === 'porta' && !temChave) {
                    throw new Error("Você precisa da chave para abrir a porta!");
                }
                posicaoJogador[0]++;
                mostrarLabirinto();
            }
        }

        function temObstáculoADireita() {
            return posicaoJogador[1] < labirinto[0].length - 1 && labirinto[posicaoJogador[0]][posicaoJogador[1]+1] === 'obstáculo';
        }

        function pegarChave() {
            if (labirinto[posicaoJogador[0]][posicaoJogador[1]] === 'chave') {
                temChave = true;
                labirinto[posicaoJogador[0]][posicaoJogador[1]] = 'caminho';
                mostrarLabirinto();
            } else {
                throw new Error("Não há chave nesta posição!");
            }
        }

        function abrirPorta() {
            if (temChave && labirinto[posicaoJogador[0]][posicaoJogador[1]] === 'porta') {
                labirinto[posicaoJogador[0]][posicaoJogador[1]] = 'caminho';
                mostrarLabirinto();
            } else {
                throw new Error("Você não pode abrir a porta aqui!");
            }
        }

        function executarCodigo() {
            posicaoJogador = [0, 0];
            temChave = false;
            criarLabirinto(niveis[nivelAtual].tamanho);
            const codigo = document.getElementById('codigo').value;
            try {
                eval(codigo);
                if (verificarVitoria()) {
                    document.getElementById('mensagem').textContent = "Parabéns! Você chegou ao objetivo!";
                } else {
                    document.getElementById('mensagem').textContent = "Tente novamente. Você não chegou ao objetivo.";
                }
            } catch (error) {
                document.getElementById('mensagem').textContent = "Erro no código: " + error.message;
            }
        }

        function reiniciarNivel() {
            iniciarNivel();
        }

        // ... (outras funções mantidas) ...

        iniciarNivel();
    </script>
</body>
</html>
